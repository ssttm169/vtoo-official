"use strict";(self.webpackChunkvtoo_official=self.webpackChunkvtoo_official||[]).push([[586],{5400:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var s=a(758),n=a(7041),l=a(6997),r=a(2829),o=a.n(r),i=(a(7759),a(384)),c=a(8026),m=a(6423),d=(a(1797),a(6070));const u=e=>{let{children:t}=e;const[a,n]=(0,s.useState)(""),l=i.A.canUseDOM?"/api":"";return(0,s.useEffect)((()=>{(async()=>{try{const e=await fetch(`${l}/csrf-token`,{method:"GET",credentials:"include"});if(!e.ok)throw new Error("Network response was not ok");const t=await e.json();n(t.csrfToken)}catch(e){console.error("Error fetching CSRF token:",e)}})()}),[]),(0,s.useEffect)((()=>{if(a){const e=window.fetch;return window.fetch=function(t,s){return void 0===s&&(s={}),s.headers=s.headers||{},s.headers["X-CSRF-Token"]=a,e(t,s)},()=>{window.fetch=e}}}),[a]),(0,d.jsx)(d.Fragment,{children:t})},h=e=>{let{isOpen:t,onClose:a,children:s}=e;return t?(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:(0,d.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl max-w-md w-full",children:[s,(0,d.jsx)("div",{className:"text-right",children:(0,d.jsx)("button",{style:{border:"none"},onClick:a,className:"submit-btn mt-4  bg-[#663399] text-white font-bold py-2.5 px-4 rounded ",children:"Close"})})]})}):null},x=()=>{const{siteConfig:e}=(0,m.A)(),t=e.customFields.apiToken,[a,r]=(0,s.useState)(null),[x,p]=(0,s.useState)(null),[f,b]=(0,s.useState)(!1),j=i.A.canUseDOM?"/api":"",w=["image/jpeg","image/png"],g=l.Ik().shape({full_name:l.Yj().required("Please Enter Your Name"),email:l.Yj().email("Incorrect mailbox format").required("Please enter email"),subject:l.Yj().required("Please enter subject"),content:l.Yj().required("Please enter content"),captcha:l.Yj().required("Please enter captcha"),attachments:l.gl().nullable().test("fileFormat","Unsupported Format",(e=>!e||Array.from(e).every((e=>w.includes(e.type))))).test("fileSize","Max allowed size is 1MB",(e=>!e||Array.from(e).every((e=>e.size<=1048576)))).test("fileLimit","Max allowed 2 images",(e=>!e||Array.from(e).length<3))});let y=`${j}/captcha`;const[v,N]=(0,s.useState)(y),[k,S]=(0,s.useState)(!0),C=()=>{S((e=>!e)),setTimeout((()=>{N(`${y}?t=${Date.now()}`),S((e=>!e))}))};return(0,d.jsx)(c.A,{title:"Support",description:"Description will go into a meta tag in <head />",children:(0,d.jsx)(u,{children:(0,d.jsxs)("div",{className:"custom-page",children:[(0,d.jsx)("div",{style:{padding:"10px"}}),(0,d.jsx)("div",{children:(0,d.jsxs)("main",{className:"custom-page-main p-4",children:[(0,d.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Support"}),(0,d.jsx)(n.l1,{initialValues:{full_name:"",email:"",subject:"",content:"",captcha:"",attachments:null},validationSchema:g,onSubmit:async(e,a)=>{let{setSubmitting:s,resetForm:n}=a;p(null);if(!await(async e=>{try{const t=await fetch(`${j}/captcha/verify`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({captcha:e})});if(!t.ok)throw new Error("\u9a8c\u8bc1\u7801\u9a8c\u8bc1\u5931\u8d25");return(await t.json()).valid}catch(t){return console.error("\u9a8c\u8bc1\u7801\u9a8c\u8bc1\u9519\u8bef:",t),!1}})(e.captcha))return p("\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165"),s(!1),void document.querySelector("#captchaImg").click();const l=Object.keys(e).reduce(((t,a)=>(t[a]=o().sanitize(e[a]),t)),{});console.log("sanitizedValues",l);let i=[];if(e.attachments){const a=await(async e=>{try{const a=new FormData;Array.from(e).forEach((e=>{a.append("files",e)}));const s=await fetch(`${j}/upload`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:a});if(!s.ok)throw new Error("\u4e0a\u4f20\u56fe\u7247\u5f02\u5e38");return await s.json()}catch(a){return console.error("\u4e0a\u4f20\u56fe\u7247\u5f02\u5e38",a),setFieldError("attachments","\u4e0a\u4f20\u56fe\u7247\u5f02\u5e382"),!1}})(e.attachments);i=a.map((e=>e.id))}try{l.attachments=i?.length?i:[];const e={data:l},a=await fetch(`${j}/supports`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(!a.ok)throw new Error("\u63d0\u4ea4\u5931\u8d25");await a.json();r("success"),n(),b(!0)}catch(c){console.error("\u63d0\u4ea4\u9519\u8bef:",c),r("error")}finally{s(!1)}},children:e=>{let{isSubmitting:t,setFieldValue:s}=e;return(0,d.jsxs)(n.lV,{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"full_name",className:"font-black block text-sm font-medium text-gray-700 mb-1",children:"Your Name:"}),(0,d.jsx)(n.D0,{type:"text",name:"full_name",className:" vtoo-input w-full px-3 text-base leading-10   rounded-md shadow-sm   "}),(0,d.jsx)(n.Kw,{name:"full_name",component:"div",className:"error-text text-sm mt-1"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"email",className:"font-black block text-sm font-medium text-gray-700 mb-1",children:"Email:"}),(0,d.jsx)(n.D0,{type:"email",name:"email",className:" vtoo-input w-full px-3  text-base leading-10  rounded-md shadow-sm   "}),(0,d.jsx)(n.Kw,{name:"email",component:"div",className:"error-text text-sm mt-1"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"subject",className:"font-black block text-sm font-medium text-gray-700 mb-1",children:"Subject:"}),(0,d.jsx)(n.D0,{type:"text",name:"subject",className:" vtoo-input w-full px-3  text-base leading-10  rounded-md shadow-sm   "}),(0,d.jsx)(n.Kw,{name:"subject",component:"div",className:"error-text text-sm mt-1"})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"content",className:"font-black block text-sm font-medium text-gray-700 mb-1",children:"Content:"}),(0,d.jsx)(n.D0,{as:"textarea",name:"content",rows:"4",className:"vtoo-textarea w-full px-3  border text-base leading-10  rounded-md shadow-sm   "}),(0,d.jsx)(n.Kw,{name:"content",component:"div",className:"error-text text-sm mt-1"})]}),(0,d.jsxs)("div",{className:"grid-col",children:[(0,d.jsx)(n.D0,{type:"text",name:"captcha",style:{height:"44px"},className:" vtoo-input w-full px-3  text-base leading-10  rounded-md shadow-sm   "}),k&&(0,d.jsx)("img",{id:"captchaImg",className:"rounded-md  captchaCls",height:44,src:v,onClick:C}),(0,d.jsx)(n.Kw,{name:"captcha",component:"div",className:"error-text text-sm mt-1"}),x&&(0,d.jsx)("div",{className:"text-red-500 text-sm mt-1",children:x})]}),(0,d.jsxs)("div",{children:[(0,d.jsx)("label",{htmlFor:"attachments",className:"font-black block text-sm font-medium text-gray-700 mb-1",children:"Upload Attachment:"}),(0,d.jsx)("input",{id:"attachments",name:"attachments",type:"file",multiple:!0,accept:"image/jpeg, image/png",onChange:e=>{s("attachments",e.currentTarget.files)},className:" vtoo-input w-full px-3 text-base leading-10 rounded-md shadow-sm"}),(0,d.jsx)(n.Kw,{name:"attachments",component:"div",className:"error-text text-sm mt-1"})]}),(0,d.jsx)("button",{type:"submit",disabled:t,style:{border:"none",height:"44px"},className:"submit-btn text-base leading-10 w-full bg-[#663399] text-white font-bold px-4 rounded-md focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:t?"Submitting...":"Submit"}),"error"===a&&(0,d.jsx)("div",{className:"text-red-500 text-sm mt-2",children:"Submission failed, please try again later."})]})}}),(0,d.jsxs)(h,{isOpen:f,onClose:()=>b(!1),children:[(0,d.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Submit successfully"}),(0,d.jsx)("p",{children:"Your form has been submitted successfully. We will get back to you shortly."})]})]})})]})})})}}}]);